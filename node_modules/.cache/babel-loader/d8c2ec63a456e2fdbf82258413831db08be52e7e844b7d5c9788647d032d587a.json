{"ast":null,"code":"import React from'react';import{Modal,Box,IconButton,Button,Typography,Avatar}from'@mui/material';import CloseIcon from'@mui/icons-material/Close';import LoginForm from'../forms/LoginForm';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function LoginModal(_ref){let{onClose}=_ref;const[isLoggedIn,setIsLoggedIn]=React.useState(false);const[emailActual,setEmailActual]=React.useState(localStorage.getItem('token-email'));React.useEffect(()=>{const checkToken=()=>{const token=localStorage.getItem('token');const email=localStorage.getItem('token-email');setIsLoggedIn(!!token);setEmailActual(email);};window.addEventListener('storage',checkToken);checkToken();return()=>window.removeEventListener('storage',checkToken);},[]);const handleLogout=()=>{localStorage.removeItem('token');localStorage.removeItem('token-email');setIsLoggedIn(false);setEmailActual(null);if(onClose)onClose();};return/*#__PURE__*/_jsx(Modal,{open:true,onClose:onClose,\"aria-labelledby\":\"modal-login\",\"aria-describedby\":\"login-accessible\",children:/*#__PURE__*/_jsxs(Box,{role:\"dialog\",\"aria-modal\":\"true\",sx:{position:'absolute',top:'50%',left:'50%',transform:'translate(-50%, -50%)',bgcolor:'#e6f4ea',p:4,borderRadius:4,width:{xs:'90%',sm:400},boxShadow:10,outline:'none',display:'flex',flexDirection:'column',gap:2,alignItems:'center',border:'2px solid #2e7d32'},children:[/*#__PURE__*/_jsx(IconButton,{onClick:onClose,sx:{position:'absolute',top:10,right:10,color:'#2e7d32'},\"aria-label\":\"Cerrar login\",children:/*#__PURE__*/_jsx(CloseIcon,{})}),/*#__PURE__*/_jsx(Avatar,{sx:{bgcolor:'#2e7d32',width:56,height:56}}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",fontWeight:600,color:\"primary\",sx:{mt:1},children:\"Iniciar sesi\\xF3n\"}),!isLoggedIn&&/*#__PURE__*/_jsx(LoginForm,{onClose:onClose,onLoginSuccess:()=>{setIsLoggedIn(true);setEmailActual(localStorage.getItem('token-email'));}}),isLoggedIn&&emailActual&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Typography,{color:\"textSecondary\",children:[\"Sesi\\xF3n activa como \",/*#__PURE__*/_jsx(\"strong\",{children:emailActual})]}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"error\",fullWidth:true,onClick:handleLogout,sx:{mt:2},children:\"Cerrar sesi\\xF3n\"})]})]})});}","map":{"version":3,"names":["React","Modal","Box","IconButton","Button","Typography","Avatar","CloseIcon","LoginForm","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","LoginModal","_ref","onClose","isLoggedIn","setIsLoggedIn","useState","emailActual","setEmailActual","localStorage","getItem","useEffect","checkToken","token","email","window","addEventListener","removeEventListener","handleLogout","removeItem","open","children","role","sx","position","top","left","transform","bgcolor","p","borderRadius","width","xs","sm","boxShadow","outline","display","flexDirection","gap","alignItems","border","onClick","right","color","height","variant","fontWeight","mt","onLoginSuccess","fullWidth"],"sources":["C:/MercadoAgricola-/frontend/src/components/modals/LoginModal.jsx"],"sourcesContent":["import React from 'react';\r\nimport {\r\n  Modal,\r\n  Box,\r\n  IconButton,\r\n  Button,\r\n  Typography,\r\n  Avatar\r\n} from '@mui/material';\r\nimport CloseIcon from '@mui/icons-material/Close';\r\nimport LoginForm from '../forms/LoginForm';\r\n\r\nexport default function LoginModal({ onClose }) {\r\n  const [isLoggedIn, setIsLoggedIn] = React.useState(false);\r\n  const [emailActual, setEmailActual] = React.useState(localStorage.getItem('token-email'));\r\n\r\n  React.useEffect(() => {\r\n    const checkToken = () => {\r\n      const token = localStorage.getItem('token');\r\n      const email = localStorage.getItem('token-email');\r\n      setIsLoggedIn(!!token);\r\n      setEmailActual(email);\r\n    };\r\n\r\n    window.addEventListener('storage', checkToken);\r\n    checkToken();\r\n\r\n    return () => window.removeEventListener('storage', checkToken);\r\n  }, []);\r\n\r\n  const handleLogout = () => {\r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('token-email');\r\n    setIsLoggedIn(false);\r\n    setEmailActual(null);\r\n    if (onClose) onClose();\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      open\r\n      onClose={onClose}\r\n      aria-labelledby=\"modal-login\"\r\n      aria-describedby=\"login-accessible\"\r\n    >\r\n      <Box\r\n        role=\"dialog\"\r\n        aria-modal=\"true\"\r\n        sx={{\r\n          position: 'absolute',\r\n          top: '50%',\r\n          left: '50%',\r\n          transform: 'translate(-50%, -50%)',\r\n          bgcolor: '#e6f4ea',\r\n          p: 4,\r\n          borderRadius: 4,\r\n          width: { xs: '90%', sm: 400 },\r\n          boxShadow: 10,\r\n          outline: 'none',\r\n          display: 'flex',\r\n          flexDirection: 'column',\r\n          gap: 2,\r\n          alignItems: 'center',\r\n          border: '2px solid #2e7d32'\r\n        }}\r\n      >\r\n        {/* Botón cerrar */}\r\n        <IconButton\r\n          onClick={onClose}\r\n          sx={{ position: 'absolute', top: 10, right: 10, color: '#2e7d32' }}\r\n          aria-label=\"Cerrar login\"\r\n        >\r\n          <CloseIcon />\r\n        </IconButton>\r\n\r\n        {/* Avatar verde como ícono */}\r\n        <Avatar sx={{ bgcolor: '#2e7d32', width: 56, height: 56 }} />\r\n\r\n        {/* Título */}\r\n        <Typography variant=\"h6\" fontWeight={600} color=\"primary\" sx={{ mt: 1 }}>\r\n          Iniciar sesión\r\n        </Typography>\r\n\r\n        {/* Formulario si no está logueado */}\r\n        {!isLoggedIn && (\r\n          <LoginForm\r\n            onClose={onClose}\r\n            onLoginSuccess={() => {\r\n              setIsLoggedIn(true);\r\n              setEmailActual(localStorage.getItem('token-email'));\r\n            }}\r\n          />\r\n        )}\r\n\r\n        {/* Bienvenida si está logueado */}\r\n        {isLoggedIn && emailActual && (\r\n          <>\r\n            <Typography color=\"textSecondary\">\r\n              Sesión activa como <strong>{emailActual}</strong>\r\n            </Typography>\r\n            <Button\r\n              variant=\"contained\"\r\n              color=\"error\"\r\n              fullWidth\r\n              onClick={handleLogout}\r\n              sx={{ mt: 2 }}\r\n            >\r\n              Cerrar sesión\r\n            </Button>\r\n          </>\r\n        )}\r\n      </Box>\r\n    </Modal>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}