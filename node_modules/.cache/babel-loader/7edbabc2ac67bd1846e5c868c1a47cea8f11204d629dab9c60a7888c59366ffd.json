{"ast":null,"code":"import React from'react';import{Box,Typography,TextField,Button,IconButton,InputAdornment,Snackbar,Alert}from'@mui/material';import VisibilityIcon from'@mui/icons-material/Visibility';import VisibilityOffIcon from'@mui/icons-material/VisibilityOff';import{useNavigate}from'react-router-dom';import{apiFetch}from'../../apiFetch';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function LoginForm(_ref){let{onClose,onLoginSuccess}=_ref;const[mostrarClave,setMostrarClave]=React.useState(false);const[errorLogin,setErrorLogin]=React.useState('');const[camposVacios,setCamposVacios]=React.useState({email:false,password:false});const navigate=useNavigate();const onSubmit=async data=>{var _data$email,_data$password;const email=(_data$email=data.email)===null||_data$email===void 0?void 0:_data$email.trim().toLowerCase();const password=(_data$password=data.password)===null||_data$password===void 0?void 0:_data$password.trim();const nuevosErrores={email:!email,password:!password};setCamposVacios(nuevosErrores);if(nuevosErrores.email||nuevosErrores.password)return;try{const res=await apiFetch('/api/usuarios/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({correo:email,contraseña:password})});const responseData=await res.json();if(res.status===404)throw new Error('Usuario no encontrado');if(res.status===401)throw new Error('Contraseña incorrecta');if(!res.ok)throw new Error(responseData.error||'Error de autenticación');const{rol}=responseData;// Redirección por rol institucional\nif(rol==='admin'){navigate('/comprar');}else if(rol==='usuario'){navigate('/comprar');}else{throw new Error('Rol no reconocido');}// Guardado visual de sesión\nlocalStorage.setItem('token',responseData.token);localStorage.setItem('token-email',responseData.correo);localStorage.setItem('rol',rol);if(onLoginSuccess)onLoginSuccess();if(onClose)onClose();window.dispatchEvent(new Event('storage'));}catch(error){setErrorLogin(error.message);}};return/*#__PURE__*/_jsxs(Box,{component:\"form\",onSubmit:e=>{var _e$target$email,_e$target$password;e.preventDefault();onSubmit({email:(_e$target$email=e.target.email)===null||_e$target$email===void 0?void 0:_e$target$email.value,password:(_e$target$password=e.target.password)===null||_e$target$password===void 0?void 0:_e$target$password.value});},noValidate:true,sx:{width:350,bgcolor:'white',p:4,borderRadius:3,boxShadow:'0 8px 24px rgba(56,142,60,0.3)',display:'flex',flexDirection:'column',gap:2,fontFamily:\"'Segoe UI', sans-serif\"},children:[/*#__PURE__*/_jsx(TextField,{name:\"email\",label:\"Correo electr\\xF3nico\",type:\"email\",fullWidth:true,autoFocus:true,autoComplete:\"username\",variant:\"outlined\",error:camposVacios.email,helperText:camposVacios.email?'Este campo es obligatorio':'',sx:{'& label.Mui-focused':{color:'#4caf50'},'& .MuiOutlinedInput-root':{'&.Mui-focused fieldset':{borderColor:'#4caf50'}}}}),/*#__PURE__*/_jsx(TextField,{name:\"password\",label:\"Contrase\\xF1a\",type:mostrarClave?'text':'password',fullWidth:true,autoComplete:\"current-password\",variant:\"outlined\",error:camposVacios.password,helperText:camposVacios.password?'Este campo es obligatorio':'',InputProps:{endAdornment:/*#__PURE__*/_jsx(InputAdornment,{position:\"end\",children:/*#__PURE__*/_jsx(IconButton,{onClick:()=>setMostrarClave(!mostrarClave),edge:\"end\",sx:{color:'#4caf50'},children:mostrarClave?/*#__PURE__*/_jsx(VisibilityOffIcon,{}):/*#__PURE__*/_jsx(VisibilityIcon,{})})})},sx:{'& label.Mui-focused':{color:'#4caf50'},'& .MuiOutlinedInput-root':{'&.Mui-focused fieldset':{borderColor:'#4caf50'}}}}),/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"contained\",fullWidth:true,sx:{background:'linear-gradient(to right, #66bb6a, #43a047)',color:'#fff',fontWeight:'bold',paddingY:1.2,borderRadius:2,'&:hover':{background:'linear-gradient(to right, #81c784, #388e3c)'}},children:\"ENTRAR\"}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",align:\"center\",sx:{mt:1,color:'#4caf50'},children:[\"\\xBFNo tienes cuenta?\",' ',/*#__PURE__*/_jsx(\"a\",{href:\"/registro\",style:{fontWeight:'bold',color:'#388e3c',textDecoration:'underline'},children:\"Reg\\xEDstrate aqu\\xED\"})]}),/*#__PURE__*/_jsx(Snackbar,{open:!!errorLogin,autoHideDuration:4000,onClose:()=>setErrorLogin(''),anchorOrigin:{vertical:'bottom',horizontal:'center'},children:/*#__PURE__*/_jsx(Alert,{severity:\"error\",variant:\"filled\",onClose:()=>setErrorLogin(''),children:errorLogin})})]});}","map":{"version":3,"names":["React","Box","Typography","TextField","Button","IconButton","InputAdornment","Snackbar","Alert","VisibilityIcon","VisibilityOffIcon","useNavigate","apiFetch","jsx","_jsx","jsxs","_jsxs","LoginForm","_ref","onClose","onLoginSuccess","mostrarClave","setMostrarClave","useState","errorLogin","setErrorLogin","camposVacios","setCamposVacios","email","password","navigate","onSubmit","data","_data$email","_data$password","trim","toLowerCase","nuevosErrores","res","method","headers","body","JSON","stringify","correo","contraseña","responseData","json","status","Error","ok","error","rol","localStorage","setItem","token","window","dispatchEvent","Event","message","component","e","_e$target$email","_e$target$password","preventDefault","target","value","noValidate","sx","width","bgcolor","p","borderRadius","boxShadow","display","flexDirection","gap","fontFamily","children","name","label","type","fullWidth","autoFocus","autoComplete","variant","helperText","color","borderColor","InputProps","endAdornment","position","onClick","edge","background","fontWeight","paddingY","align","mt","href","style","textDecoration","open","autoHideDuration","anchorOrigin","vertical","horizontal","severity"],"sources":["C:/MercadoAgricola-/frontend/src/components/forms/LoginForm.jsx"],"sourcesContent":["import React from 'react';\nimport {\n  Box,\n  Typography,\n  TextField,\n  Button,\n  IconButton,\n  InputAdornment,\n  Snackbar,\n  Alert\n} from '@mui/material';\nimport VisibilityIcon from '@mui/icons-material/Visibility';\nimport VisibilityOffIcon from '@mui/icons-material/VisibilityOff';\nimport { useNavigate } from 'react-router-dom';\nimport { apiFetch } from '../../apiFetch';\n\nexport default function LoginForm({ onClose, onLoginSuccess }) {\n  const [mostrarClave, setMostrarClave] = React.useState(false);\n  const [errorLogin, setErrorLogin] = React.useState('');\n  const [camposVacios, setCamposVacios] = React.useState({\n    email: false,\n    password: false\n  });\n\n  const navigate = useNavigate();\n\n  const onSubmit = async (data) => {\n    const email = data.email?.trim().toLowerCase();\n    const password = data.password?.trim();\n\n    const nuevosErrores = {\n      email: !email,\n      password: !password\n    };\n    setCamposVacios(nuevosErrores);\n    if (nuevosErrores.email || nuevosErrores.password) return;\n\n    try {\n      const res = await apiFetch('/api/usuarios/login', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ correo: email, contraseña: password })\n      });\n\n      const responseData = await res.json();\n\n      if (res.status === 404) throw new Error('Usuario no encontrado');\n      if (res.status === 401) throw new Error('Contraseña incorrecta');\n      if (!res.ok) throw new Error(responseData.error || 'Error de autenticación');\n\n      const { rol } = responseData;\n\n      // Redirección por rol institucional\n      if (rol === 'admin') {\n        navigate('/comprar');\n      } else if (rol === 'usuario') {\n        navigate('/comprar');\n      } else {\n        throw new Error('Rol no reconocido');\n      }\n\n      // Guardado visual de sesión\n      localStorage.setItem('token', responseData.token);\n      localStorage.setItem('token-email', responseData.correo);\n      localStorage.setItem('rol', rol);\n\n      if (onLoginSuccess) onLoginSuccess();\n      if (onClose) onClose();\n      window.dispatchEvent(new Event('storage'));\n    } catch (error) {\n      setErrorLogin(error.message);\n    }\n  };\n\n  return (\n    <Box\n      component=\"form\"\n      onSubmit={(e) => {\n        e.preventDefault();\n        onSubmit({\n          email: e.target.email?.value,\n          password: e.target.password?.value\n        });\n      }}\n      noValidate\n      sx={{\n        width: 350,\n        bgcolor: 'white',\n        p: 4,\n        borderRadius: 3,\n        boxShadow: '0 8px 24px rgba(56,142,60,0.3)',\n        display: 'flex',\n        flexDirection: 'column',\n        gap: 2,\n        fontFamily: \"'Segoe UI', sans-serif\"\n      }}\n    >\n      <TextField\n        name=\"email\"\n        label=\"Correo electrónico\"\n        type=\"email\"\n        fullWidth\n        autoFocus\n        autoComplete=\"username\"\n        variant=\"outlined\"\n        error={camposVacios.email}\n        helperText={camposVacios.email ? 'Este campo es obligatorio' : ''}\n        sx={{\n          '& label.Mui-focused': { color: '#4caf50' },\n          '& .MuiOutlinedInput-root': {\n            '&.Mui-focused fieldset': {\n              borderColor: '#4caf50'\n            }\n          }\n        }}\n      />\n\n      <TextField\n        name=\"password\"\n        label=\"Contraseña\"\n        type={mostrarClave ? 'text' : 'password'}\n        fullWidth\n        autoComplete=\"current-password\"\n        variant=\"outlined\"\n        error={camposVacios.password}\n        helperText={camposVacios.password ? 'Este campo es obligatorio' : ''}\n        InputProps={{\n          endAdornment: (\n            <InputAdornment position=\"end\">\n              <IconButton\n                onClick={() => setMostrarClave(!mostrarClave)}\n                edge=\"end\"\n                sx={{ color: '#4caf50' }}\n              >\n                {mostrarClave ? <VisibilityOffIcon /> : <VisibilityIcon />}\n              </IconButton>\n            </InputAdornment>\n          )\n        }}\n        sx={{\n          '& label.Mui-focused': { color: '#4caf50' },\n          '& .MuiOutlinedInput-root': {\n            '&.Mui-focused fieldset': {\n              borderColor: '#4caf50'\n            }\n          }\n        }}\n      />\n\n      <Button\n        type=\"submit\"\n        variant=\"contained\"\n        fullWidth\n        sx={{\n          background: 'linear-gradient(to right, #66bb6a, #43a047)',\n          color: '#fff',\n          fontWeight: 'bold',\n          paddingY: 1.2,\n          borderRadius: 2,\n          '&:hover': {\n            background: 'linear-gradient(to right, #81c784, #388e3c)'\n          }\n        }}\n      >\n        ENTRAR\n      </Button>\n\n      <Typography variant=\"body2\" align=\"center\" sx={{ mt: 1, color: '#4caf50' }}>\n        ¿No tienes cuenta?{' '}\n        <a\n          href=\"/registro\"\n          style={{\n            fontWeight: 'bold',\n            color: '#388e3c',\n            textDecoration: 'underline'\n          }}\n        >\n          Regístrate aquí\n        </a>\n      </Typography>\n\n      <Snackbar\n        open={!!errorLogin}\n        autoHideDuration={4000}\n        onClose={() => setErrorLogin('')}\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}\n      >\n        <Alert severity=\"error\" variant=\"filled\" onClose={() => setErrorLogin('')}>\n          {errorLogin}\n        </Alert>\n      </Snackbar>\n    </Box>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}